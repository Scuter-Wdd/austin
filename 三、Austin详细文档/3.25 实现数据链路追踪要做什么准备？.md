**è§†é¢‘è®²è§£ï¼š**
[![#24 å…¨é“¾è·¯è¿½è¸ªåŸºç¡€ï¼ˆåŸ‹ç‚¹ï¼‰.mp4 (389.94MB)](https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ)]()ä»ä¹‹å‰æ‰“å°çš„æ—¥å¿—ä»¥åŠèƒ½å¾ˆå¿«åœ°æ’æŸ¥å‡º**æ¥å…¥å±‚**çš„é—®é¢˜äº†ï¼Œå…¶å®é‡å¤´æˆå…¶å®æ˜¯åœ¨**å¤„ç†å±‚**ä¸Šï¼Œå›é¡¾ä¸‹å¤„ç†å±‚ç›®å‰åšçš„äº‹æƒ…ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660567359-27a5f0a0-f7b4-4e0b-a46f-6e02e1fcb811.png#averageHue=%23f7f4f1&clientId=u9fb0af73-01e3-4&from=paste&id=ufeeac516&originHeight=942&originWidth=2582&originalType=url&ratio=1&rotation=0&showTitle=false&size=672991&status=done&style=none&taskId=u2bf3060f-6524-400b-bc38-87eb6064abb&title=)

åœ¨å¤„ç†å±‚ä¸Šä¼šæœ‰ä¸å°‘çš„**å¹³å°è¿‡æ»¤è§„åˆ™**ï¼Œè¿™äº›è¿‡æ»¤è§„åˆ™å¤§å¤šéƒ½ä¸æ˜¯é’ˆå¯¹äºæ¶ˆæ¯æ¨¡æ¿çš„ï¼Œè€Œæ˜¯é’ˆå¯¹äºuserId(æ¥æ”¶è€…)çš„ã€‚åœ¨è¿™ä¸ªå¤„ç†è¿‡ç¨‹ä¸­ï¼Œè®°å½•ä¸‹**æ¯ä¸ªæ¶ˆæ¯æ¨¡æ¿ä¸­çš„æ¯ä¸ªç”¨æˆ·çš„æ‰§è¡Œæƒ…å†µ**å°±å°¤å…¶é‡è¦äº†ã€‚

**1**ã€å®šä½å’Œæ’æŸ¥é—®é¢˜ã€‚å¦‚æœå®¢æˆ·åé¦ˆç”¨æˆ·æ”¶ä¸åˆ°çŸ­ä¿¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½åœ¨è¿™ä¸ªå¤„ç†çš„è¿‡ç¨‹ä¸­å¯¼è‡´çš„ï¼ˆå¯èƒ½æ˜¯è¢«å»é‡ï¼Œå¯èƒ½æ˜¯è°ƒç”¨æ¥å£å‡ºé—®é¢˜ï¼‰

**2**ã€å¯¹æ¨¡æ¿æ‰§è¡Œçš„æ•´ä½“é“¾è·¯æ•°æ®åˆ†æã€‚ä¸€ä¸ªæ¶ˆæ¯æ¨¡æ¿ä¸€å¤©å‘é€çš„é‡çº§ï¼Œä¸­é€”è¢«**æ¯ä¸ªè§„åˆ™**è¿‡æ»¤çš„é‡çº§ï¼ŒæˆåŠŸä¸‹å‘çš„é‡çº§ä»¥åŠæ¶ˆæ¯æœ€åè¢«ç‚¹å‡»çš„é‡çº§ã€‚**é™¤äº†ç‚¹å‡»æ•°æ®ï¼Œå…¶ä»–çš„æ•°æ®éƒ½æ¥æºå¤„ç†å±‚**

åŸºäºä¸Šé¢çš„èƒŒæ™¯ï¼Œæˆ‘è®¾è®¡äº†ä¸€å¥—åŸ‹ç‚¹çš„è§„åˆ™ï¼Œåœ¨å¤„ç†**å…³é”®é“¾è·¯ä¸Š**æ‰“ä¸Šå¯¹åº”çš„ç‚¹ä½ğŸ“
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660628181-5993c728-0d0c-47ff-b3fe-f914573c162e.png#averageHue=%232d2d2d&clientId=u9fb0af73-01e3-4&from=paste&height=621&id=u33dbf0ba&originHeight=1242&originWidth=1790&originalType=binary&ratio=1&rotation=0&showTitle=false&size=271397&status=done&style=none&taskId=u5e006082-4cf1-431b-8c94-b72b791eec2&title=&width=895)
ç›®å‰ç‚¹ä½çš„ä¿¡æ¯è¿˜æ˜¯ä¸å…¨çš„ï¼Œéšç€ç³»ç»Ÿçš„å®Œå–„å’Œæ¥å…¥å„ä¸ªæ¸ é“ï¼Œè¿™é‡Œçš„ç‚¹ä½ä¿¡æ¯è¿˜ä¼šç»§ç»­å¢åŠ ï¼Œåªè¦æˆ‘ä»¬è®¤ä¸ºæœ‰å“ªäº›åœ°æ–¹æ˜¯éœ€è¦è®°å½•ä¸‹æ¥çš„ï¼Œå°±å¯ä»¥å¢åŠ ã€‚

å¯èƒ½çœ‹åˆ°è¿™é‡Œä½ ä¼šè§‰å¾—æœ‰äº›æŠ½è±¡ï¼Œæˆ‘è¯·æ±‚ä¸€æ¬¡æ¥å£æ‰“å°ä¸‹æ—¥å¿—å°±å®¹æ˜“æ‡‚å•¦ï¼š
```java
// 1ã€æ¥å…¥å±‚æ‰“å°æ—¥å¿—ï¼ˆreturnStræ‰“å°å¤„ç†ç»“æœï¼Œè€Œmsgæ‰“å°å‡ºå…¥å‚ä¿¡æ¯ï¼‰
2022-01-08 15:44:53.512 [http-nio-8080-exec-7] INFO  com.java3y.austin.utils.LogUtils - 
{"bizId":"1","bizType":"SendService#send","logId":"34df87fc-0489-46c1-b39f-cafd7652f55b",
"msg":"{\"code\":\"send\",\"messageParam\":{\"extra\":null,\"receiver\":\"13288888888\",\"variables\":{\"title\":\"yyyyyy\",\"contentValue\":\"66661641627893157\"}},\"messageTemplateId\":1}","operateDate":1641627893512,"returnStr":"{\"code\":\"00000\",\"msg\":\"æ“ä½œæˆåŠŸ\"}","success":true,"tag":"operation"}

// 2ã€å¤„ç†å±‚æ‰“å°å…¥å£æ—¥å¿—ï¼ˆè¡¨ç¤ºæˆåŠŸæ¶ˆè´¹åˆ°Kafkaçš„æ¶ˆæ¯ state=10ï¼‰
2022-01-08 15:44:53.622 [org.springframework.kafka.KafkaListenerEndpointContainer#6-0-C-1] INFO  com.java3y.austin.utils.LogUtils - 
{"businessId":1000000120220108,"ids":["13288888888"],"state":10,"timestamp":1641627893622}

// 3ã€å¤„ç†å±‚æ‰“å°å…¥å£æ—¥å¿—ï¼ˆè¡¨ç¤ºæˆåŠŸæ¶ˆè´¹åˆ°Kafkaçš„åŸå§‹æ—¥å¿—ï¼‰
2022-01-08 15:44:53.622 [org.springframework.kafka.KafkaListenerEndpointContainer#6-0-C-1] INFO  com.java3y.austin.utils.LogUtils - 
{"bizType":"Receiver#consumer","object":{"businessId":1000000120220108,"contentModel":{"content":"66661641627893157"},"deduplicationTime":1,"idType":30,"isNightShield":0,"messageTemplateId":1,"msgType":10,"receiver":["13288888888"],"sendAccount":66,"sendChannel":30,"templateType":10},"timestamp":1641627893622}

// 4ã€å¤„ç†å±‚æ‰“å°é€»è¾‘è¿‡æ»¤æ—¥å¿—ï¼ˆstate=20ï¼Œè¡¨ç¤ºè¿™æ¡æ¶ˆæ¯ç”±äºé…ç½®äº†ä¸¢å¼ƒï¼Œå·²ç»ä¸¢å¼ƒæ‰ï¼‰
2022-01-08 15:44:53.623 [pool-8-thread-3] INFO  com.java3y.austin.utils.LogUtils - 
{"businessId":1000000120220108,"ids":["13288888888"],"state":20,"timestamp":1641627893622}
```

æˆ‘æ‰“å°æ—¥å¿—çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š

- åœ¨**å…¥å£ä¾§**ï¼ˆè¿™é‡ŒåŒ…æ‹¬æ¥å£çš„å…¥å£ä»¥åŠåˆšæ¶ˆè´¹Kafkaçš„å…¥å£ï¼‰éœ€è¦æ‰“å°å‡ºåŸå§‹çš„ä¿¡æ¯ã€‚åŸå§‹ä¿¡æ¯æœ‰äº†ï¼Œæ‰å¥½å¯¹é—®é¢˜è¿›è¡Œå®šä½å’Œæ’æŸ¥ï¼Œè‡³å°‘å¸®åŠ©æˆ‘ä»¬å¤ç°
- åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨**æŸä¸ªæ ‡è¯†**æ¥æ ‡æ˜å¤„ç†çš„è¿‡ç¨‹ï¼ˆ10ä»£è¡¨æˆåŠŸæ¶ˆè´¹Kafkaï¼Œ20ä»£è¡¨è¯¥æ¶ˆæ¯å·²ç»è¢«ä¸¢å¼ƒ...)ï¼Œå¹¶ä¸”**æ—¥å¿—çš„æ ¼å¼æ˜¯ç»Ÿä¸€**çš„è¿™æ ·åç»­æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€æ¸…æ´—è¯¥æ—¥å¿—ä¿¡æ¯

![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660566884-44facd84-b08f-4e8d-8c69-799801432926.png#averageHue=%23f8f3e4&clientId=u9fb0af73-01e3-4&from=paste&id=u0ab85762&originHeight=242&originWidth=1722&originalType=url&ratio=1&rotation=0&showTitle=false&size=123969&status=done&style=none&taskId=u8a0cb34a-28b5-4007-9796-11b3024f03e&title=)

è‡³äºæ‰“æ—¥å¿—çš„è¿‡ç¨‹å°±å¾ˆç®€å•äº†ï¼Œåªè¦æŠ½å–ä¸€ä¸ªLogUtilsç±»å°±å¥½å’¯ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660567209-1b84b2bf-74a9-4539-ad67-6ce58a87c662.png#averageHue=%232c2c2b&clientId=u9fb0af73-01e3-4&from=paste&id=ud075fc79&originHeight=1190&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&size=602667&status=done&style=none&taskId=u5a534247-5c1d-4ddb-8959-636091b2eab&title=)

é‚£å¯¹äºç‚¹å‡»æ˜¯æ€ä¹ˆè¿½è¸ªçš„å‘¢ï¼Ÿå…¶å®ä¹Ÿå¥½åŠï¼Œåœ¨**ä¸‹å‘çš„é“¾æ¥**ä¸Šæ‹¼æ¥businessIdå°±å¥½äº†ã€‚åªè¦æˆ‘ä»¬èƒ½æ‹¿åˆ°ç‚¹å‡»çš„æ•°æ®ï¼Œåœ¨é“¾æ¥ä¸Šå°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨track_code_bidå­—ç¬¦ï¼Œè¿›è€Œæ‰¾åˆ°æ˜¯å“ªä¸ªç”¨æˆ·ç‚¹å‡»äº†å“ªä¸ªæ¨¡æ¿æ¶ˆæ¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660567360-34bb125d-e4e0-4fc3-8fa4-b2fe8838fa24.png#averageHue=%232e2c2b&clientId=u9fb0af73-01e3-4&from=paste&id=u2e3cc611&originHeight=1080&originWidth=1553&originalType=url&ratio=1&rotation=0&showTitle=false&size=688434&status=done&style=none&taskId=u4a1e3ef0-98c2-497e-98d2-d0120c74cb0&title=)
æ— è®ºæ˜¯æ‰“ç‚¹æ—¥å¿—è¿˜æ˜¯åŸå§‹æ—¥å¿—ï¼ŒbusinessIdä¼šè·Ÿéšç€æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸå§‹ç»ˆã€‚è€ŒbusinessIdçš„æ„æˆåªæ˜¯é€šè¿‡**æ¶ˆæ¯æ¨¡æ¿å†…å®¹+æ—¶é—´**è€Œæˆ
![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660567696-fb3db96e-f4d6-49ee-af8a-95e3713346d1.png#averageHue=%23c0c3c3&clientId=u9fb0af73-01e3-4&from=paste&id=ua47e6116&originHeight=206&originWidth=1708&originalType=url&ratio=1&rotation=0&showTitle=false&size=80752&status=done&style=none&taskId=uc9981300-5c08-4f87-a39d-38a61a18721&title=)

ç°åœ¨å·²ç»æ‰“å°å‡ºå¯¹åº”çš„æ•°æ®é“¾è·¯ä¿¡æ¯äº†ï¼Œä½†è¿™æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™åªæ˜¯å°†æ•°æ®é“¾è·¯ä¿¡æ¯å†™åˆ°äº†æœåŠ¡å™¨çš„æœ¬åœ°ä¸Šï¼Œè¿˜éœ€è¦è€ƒè™‘ä»¥ä¸‹çš„æƒ…å†µï¼š

**1**ã€è¿è¡Œåº”ç”¨çš„æœåŠ¡å™¨ä¸€èˆ¬æ˜¯é›†ç¾¤ï¼Œæ—¥å¿—æ•°æ®ä¼šè®°å½•åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œæ’æŸ¥å’Œå®šä½é—®é¢˜åªèƒ½ç™»å½•å„ä¸ªæœåŠ¡å™¨æŸ¥çœ‹

**2**ã€é“¾è·¯çš„æ•°æ®éœ€è¦**å®æ—¶**ï¼Œé€šè¿‡æä¾›Webåå°çš„ç•Œé¢åŠŸèƒ½å¿«é€Ÿè®©**ä¸šåŠ¡æ–¹è‡ªåŠ©**æŸ¥çœ‹æ•´ä¸ªæµç¨‹

**3**ã€é“¾è·¯çš„æ•°æ®éœ€è¦ç¦»çº¿ä¿å­˜ç”¨äºå¯¹æ•°æ®çš„åˆ†æä»¥åŠç•™å¤‡ä»½ï¼ˆæœ¬åœ°æ—¥å¿—å¾€å¾€å­˜æ”¾ä¸è¶…è¿‡30å¤©ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2022/png/1285871/1649660796646-dd88d831-12eb-4a1f-aa88-8033eff60ee4.png#averageHue=%23c7dbb0&clientId=u4793eb0a-f70e-4&from=paste&id=ude736ea9&originHeight=232&originWidth=2342&originalType=url&ratio=1&rotation=0&showTitle=false&size=149320&status=done&style=none&taskId=ue4b9f717-687d-4d82-9465-3584bc64ba4&title=)

è¿™äº›åœ¨åé¢çš„æ–‡ç« éƒ½ä¼šæœ‰ï¼Œä»£ç éƒ½å·²ç»å®ç°äº†ï¼Œç»§ç»­å¾€ä¸‹çœ‹å§

